import { useState } from "react";

export default function Home() {
  const [language, setLanguage] = useState("zh");
  const [keywords, setKeywords] = useState("");
  const [title, setTitle] = useState("");
  const [result, setResult] = useState("");
  const [loading, setLoading] = useState(false);

  async function generate() {
    setLoading(true);
    setTitle("â³ æ­£åœ¨ç”Ÿæˆæ ‡é¢˜...");
    setResult("â³ æ­£åœ¨ç”Ÿæˆæ–‡æ¡ˆ...");

    const res = await fetch("/api/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ keywords, language }),
    });

    const data = await res.json();
    setLoading(false);

    if (data.title && data.result) {
      setTitle(data.title);
      setResult(data.result);

      const encoded = encodeURIComponent(`${data.title}\n${data.result}`);
      document.getElementById("fb").href = `https://www.facebook.com/sharer/sharer.php?u=&quote=${encoded}`;
      document.getElementById("tt").href = `https://www.tiktok.com/upload?caption=${encoded}`;
    } else {
      setTitle("ç”Ÿæˆå¤±è´¥");
      setResult(data.error || "æœªçŸ¥é”™è¯¯");
    }
  }

  return (
    <div style={{ padding: 20, maxWidth: 600, margin: "auto", fontFamily: "sans-serif" }}>
      <h1>ğŸ’‡â€â™€ï¸ CO HAIR æ–‡æ¡ˆåŠ©æ‰‹</h1>
      <label>é€‰æ‹©è¯­è¨€ï¼š</label>
      <select value={language} onChange={e => setLanguage(e.target.value)}>
        <option value="zh">ä¸­æ–‡</option>
        <option value="en">è‹±æ–‡</option>
      </select>

      <label>è¾“å…¥å…³é”®è¯ï¼ˆå¦‚ç†å‘å¸ˆåå­—ï¼‰ï¼š</label>
      <input type="text" value={keywords} onChange={e => setKeywords(e.target.value)} placeholder="å¦‚ï¼šyk / eilyn" style={{ width: "100%", padding: 10, marginTop: 8 }} />

      <button onClick={generate} disabled={loading} style={{ marginTop: 12, padding: 10, width: "100%" }}>
        {loading ? "ç”Ÿæˆä¸­..." : "ç”Ÿæˆæ–‡æ¡ˆ"}
      </button>

      <h3 style={{ marginTop: 24 }}>{title}</h3>
      <div style={{ whiteSpace: "pre-wrap", background: "#f4f4f4", padding: 10, borderRadius: 6 }}>{result}</div>

      <h3>åˆ†äº«åˆ°ç¤¾äº¤å¹³å°ï¼š</h3>
      <div style={{ display: "flex", gap: 16 }}>
        <a id="fb" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" width="40" /></a>
        <a id="tt" target="_blank"><img src="https://static.vecteezy.com/system/resources/previews/016/716/485/large_2x/tiktok-icon-free-png.png" width="40" /></a>
      </div>
    </div>
  );
}

import { useState } from "react";

export default function Home() {
  const [language, setLanguage] = useState("zh");
  const [keywords, setKeywords] = useState("");
  const [title, setTitle] = useState("");
  const [result, setResult] = useState("");
  const [loading, setLoading] = useState(false);

  async function generate() {
    setLoading(true);
    setTitle("⏳ 正在生成标题...");
    setResult("⏳ 正在生成文案...");

    const res = await fetch("/api/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ keywords, language }),
    });

    const data = await res.json();
    setLoading(false);

    if (data.title && data.result) {
      setTitle(data.title);
      setResult(data.result);

      const encoded = encodeURIComponent(`${data.title}\n${data.result}`);
      document.getElementById("fb").href = `https://www.facebook.com/sharer/sharer.php?u=&quote=${encoded}`;
      document.getElementById("tt").href = `https://www.tiktok.com/upload?caption=${encoded}`;
    } else {
      setTitle("生成失败");
      setResult(data.error || "未知错误");
    }
  }

  return (
    <div style={{ padding: 20, maxWidth: 600, margin: "auto", fontFamily: "sans-serif" }}>
      <h1>💇‍♀️ CO HAIR 文案助手</h1>
      <label>选择语言：</label>
      <select value={language} onChange={e => setLanguage(e.target.value)}>
        <option value="zh">中文</option>
        <option value="en">英文</option>
      </select>

      <label>输入关键词（如理发师名字）：</label>
      <input type="text" value={keywords} onChange={e => setKeywords(e.target.value)} placeholder="如：yk / eilyn" style={{ width: "100%", padding: 10, marginTop: 8 }} />

      <button onClick={generate} disabled={loading} style={{ marginTop: 12, padding: 10, width: "100%" }}>
        {loading ? "生成中..." : "生成文案"}
      </button>

      <h3 style={{ marginTop: 24 }}>{title}</h3>
      <div style={{ whiteSpace: "pre-wrap", background: "#f4f4f4", padding: 10, borderRadius: 6 }}>{result}</div>

      <h3>分享到社交平台：</h3>
      <div style={{ display: "flex", gap: 16 }}>
        <a id="fb" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" width="40" /></a>
        <a id="tt" target="_blank"><img src="https://static.vecteezy.com/system/resources/previews/016/716/485/large_2x/tiktok-icon-free-png.png" width="40" /></a>
      </div>
    </div>
  );
}

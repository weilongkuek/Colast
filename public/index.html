<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CO HAIR 文案生成器</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f6f6f6; }
    h1 { color: #333; text-align: center; }
    .container { background: white; padding: 20px; border-radius: 8px; max-width: 500px; margin: auto; }
    button, select, input { margin-top: 10px; padding: 10px; width: 100%; font-size: 16px; }
    .platforms img { width: 40px; margin: 10px; cursor: pointer; }
    .output-title { font-weight: bold; font-size: 18px; margin-top: 20px; }
    .output-body { white-space: pre-wrap; background: #eee; padding: 10px; border-radius: 6px; margin-top: 10px; }
    .loading { text-align: center; font-style: italic; color: #777; margin-top: 20px; }
    .error { color: red; font-weight: bold; text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🧠 CO HAIR 快速发文助手</h1>
    
    <label>选择语言：</label>
    <select id="language">
      <option value="zh">中文</option>
      <option value="en">English</option>
    </select>

    <label>输入关键词（如理发师名字）：</label>
    <input type="text" id="keywords" placeholder="例：yk 或 eilyn"/>

    <button id="generateBtn" onclick="generate()" disabled>加载中...</button>

    <div id="status" class="loading"></div>
    <div class="output-title" id="title"></div>
    <div class="output-body" id="output"></div>

    <div class="platforms">
      <h3>点平台图标直接跳转发文：</h3>
      <a id="fb" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" /></a>
      <a id="ig" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" /></a>
      <a id="xhs" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/XiaohongshuLOGO.png" /></a>
      <a id="tt" target="_blank"><img src="https://static.vecteezy.com/system/resources/previews/016/716/485/large_2x/tiktok-icon-free-png.png" /></a>
    </div>
  </div>

  <script>
    const btn = document.getElementById("generateBtn");
    window.addEventListener("DOMContentLoaded", () => {
      btn.disabled = false;
      btn.innerText = "生成文案";
    });

    async function generate() {
      const language = document.getElementById("language").value;
      const keywords = document.getElementById("keywords").value.trim();
      const titleEl = document.getElementById("title");
      const outputEl = document.getElementById("output");
      const statusEl = document.getElementById("status");

      if (!keywords) {
        statusEl.innerHTML = "<div class='error'>❗请输入关键词</div>";
        return;
      }

      // 清空内容
      titleEl.textContent = "";
      outputEl.textContent = "";
      statusEl.innerHTML = "⏳ 正在生成文案，请稍等...";
      btn.disabled = true;
      btn.innerText = "生成中...";

      try {
        const res = await fetch("/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            language,
            prompt: keywords, // ✅ 修正字段名称！
            style: "真实" // 默认风格，可以扩展
          })
        });

        const data = await res.json();

        if (data.title && data.result) {
          titleEl.textContent = data.title;
          outputEl.textContent = data.result;
          statusEl.innerHTML = "";

          const encodedText = encodeURIComponent(`${data.title}\n${data.result}`);
          document.getElementById("fb").href = `https://www.facebook.com/sharer/sharer.php?u=&quote=${encodedText}`;
          document.getElementById("ig").href = `https://www.instagram.com/`;
          document.getElementById("xhs").href = `https://www.xiaohongshu.com/`;
          document.getElementById("tt").href = `https://www.tiktok.com/upload?caption=${encodedText}`;
        } else {
          throw new Error(data.error || "没有返回文案");
        }
      } catch (err) {
        statusEl.innerHTML = `<div class='error'>❌ 生成失败：${err.message}</div>`;
      } finally {
        btn.disabled = false;
        btn.innerText = "生成文案";
      }
    }
  </script>
</body>
</html>
